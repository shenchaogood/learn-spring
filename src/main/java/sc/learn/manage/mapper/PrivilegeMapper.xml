<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="sc.learn.manage.mapper.PrivilegeMapper" >

	<sql id="privilegeColumnSql">
		f_id id,
		f_description description,
		f_url url,
		f_icon icon,
		f_leaf leaf,
		f_create_time create_time,
		f_update_time update_time
	</sql>

	<resultMap type="privilege" id="menuResultMap">
		<id column="f_id" property="id"/>
		<result column="f_name" property="name"/>
		<result column="f_description" property="description"/>
		<result column="f_url" property="url"/>
		<result column="f_icon" property="icon"/>
		<result column="f_leaf" property="leaf"/>
		<result column="f_create_time" property="createTime"/>
		<result column="f_update_time" property="updateTime"/>
		<collection property="children" ofType="privilege">
			<id column="c_id" property="id"/>
			<result column="c_name" property="name"/>
			<result column="c_description" property="description"/>
			<result column="c_url" property="url"/>
			<result column="c_icon" property="icon"/>
			<result column="c_leaf" property="leaf"/>
			<result column="c_create_time" property="createTime"/>
			<result column="c_update_time" property="updateTime"/>
		</collection>
	</resultMap>

	<insert id="insert" parameterType="privilege">
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
			select last_insert_id()
		</selectKey>
		insert into t_privilege(
			f_name,
			f_description,
			f_url,
			f_icon,
			f_leaf,
			f_parent_id) 
		values(
			#{name},
			#{description},
			#{url},
			#{icon},
			#{leaf},
			#{parent.id}
		)
	</insert>

	<select id="selectById" parameterType="int" resultType="privilege">
		select * from t_privilege where f_id=#{value}
	</select>
	
	<select id="selectAll" resultType="privilege">
		select * from t_privilege
	</select>
	
	<select id="selectMenuPrivileges" resultMap="menuResultMap">
		select 
			parent.f_id f_id,
			parent.f_name f_name,
			parent.f_description f_description,
			parent.f_url f_url,
			parent.f_icon f_icon,
			parent.f_leaf f_leaf,
			parent.f_create_time f_create_time,
			parent.f_update_time f_update_time,
			child.f_id c_id,
			child.f_name c_name,
			child.f_description c_description,
			child.f_url c_url,
			child.f_icon c_icon,
			child.f_leaf c_leaf,
			child.f_create_time c_create_time,
			child.f_update_time c_update_time
		from 
			(select * from t_privilege where f_parent_id = 0) parent
		left join
			t_privilege child
		on
			(parent.f_id=child.f_parent_id and !parent.f_leaf)
		order by 
			f_id asc
	</select>
	
	<select id="selectByParentId" parameterType="int" resultType="privilege">
		select <include refid="privilegeColumnSql"/> from t_privilege where f_parent_id
		<if test="value==null">is null</if>
		<if test="value!=null">=#{value}</if>
	</select>
	
	<select id="selectByIds" parameterType="int" resultType="privilege">
		select <include refid="privilegeColumnSql"/> from t_privilege 
		where id in
		<foreach collection="array" item="item" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>
	
	<select id="selectByUrl" parameterType="string" resultType="privilege">
		select <include refid="privilegeColumnSql"/> from t_privilege where f_url=#{url}
	</select>
	
	<select id="selectAllUrl" resultType="string">
		select f_url from t_privilege
	</select>
	
</mapper>